# 一体化步进电机 Modbus 通讯用户手册（开环）- 精华摘要

**来源**: `LMS-C12-18007 一体化步进电机Modbus通讯用户手册(开环)_B02.pdf`
**版本**: B02 (2024-05-17)
**总页数**: 63 页

---

## 1. 通信协议概要

- **物理层**: RS-485 总线，Modbus-RTU 协议
- **通信方式**: 单主站/多从站
- **RTU 帧结构**: `[从站地址 1B][功能码 1B][数据 0~252B][CRC 2B]`
- **帧间隔**: >= 3.5 字符时间 (t3.5)
- **默认参数**: 波特率 115.2kbps，从站地址 0x01，8数据位/无校验/1停止位
- **终端电阻**: 网络两端各接 120 欧姆

## 2. 支持的 Modbus 功能码

| 功能码 | 名称 | 用途 |
|--------|------|------|
| 0x03 | 读保持寄存器 | 读取可读写参数 |
| 0x04 | 读输入寄存器 | 读取只读状态 |
| 0x06 | 写单个保持寄存器 | 写入单个参数 |
| 0x10 | 写多个保持寄存器 | 写入多个/32位参数 |

异常响应功能码 = 正常功能码 + 0x80（如 0x83, 0x84, 0x86, 0x88, 0x90, 0x97）

### 异常码

| 异常码 | 名称 | 描述 |
|--------|------|------|
| 01 | 非法功能码 | 功能码不在 0x00~0x0F 范围内 |
| 02 | 非法数据地址 | 数据地址超出定义 |
| 03 | 非法数据值 | 寄存器存储之外的值 |
| 04 | 从设备故障 | 产生不可恢复的错误 |
| 05 | 确认 | 从站处理时间较长 |
| 06 | 从设备忙 | 等待从站设备空闲 |

## 3. 通信参数配置

### 波特率（寄存器 0x0001）

| 值 | 波特率 |
|----|--------|
| 0 | 9.6kbps |
| 1 | 9.6kbps |
| 2 | 19.2kbps |
| 3 | 38.4kbps |
| 4 | 57.6kbps |
| **5** | **115.2kbps（默认）** |
| 6 | 256kbps |
| 7 | 500kbps |
| 8 | 1Mbps |
| 9 | 1.5Mbps |

### 网络数据格式（寄存器 0x0002）

| 值 | 描述 |
|----|------|
| 0 | 8数据位, 偶校验, 1停止位 |
| 1 | 8数据位, 奇校验, 1停止位 |
| **2** | **8数据位, 无校验, 1停止位（默认）** |
| 3 | 8数据位, 无校验, 2停止位 |

### 从站地址（寄存器 0x0000）

- 范围: 1~247
- 默认: 0x01
- 修改后需保存参数并重启生效

### 广播抢占（功能码 0xD2）

- 在通信参数不确定时使用，可恢复为出厂默认
- 需在电机上电前 1 秒内发送
- 恢复后: 从站地址=1, 波特率=115200, 无校验, 8数据位, 1停止位

## 4. 电机状态机

状态流转: `开始 → 初始化 → 电机无故障 → 启动 → 使能 → 运行`

另有: `紧急停机`、`故障激活`、`故障` 状态

### 状态描述

| 状态 | 描述 |
|------|------|
| 初始化 | 电机驱动器初始化、内部自检完成，不能设参不能驱动 |
| 电机无故障 | 无故障或错误已排除，可以设参 |
| 启动 | 电机驱动器启动，可以设参 |
| 使能 | 电机驱动器输出电压给电机，可以设参 |
| 运行 | 正常运行，通过指令控制旋转，不可设参 |
| 紧急停机 | 执行紧急停机功能指令，不可设参 |
| 故障激活 | 发生故障，正在故障停机过程中 |
| 故障 | 故障停机完成，所有驱动功能禁止，可以排障设参 |

### 状态转换控制字

| 转换 | 控制字 | 期望状态字 |
|------|--------|----------|
| 0: 开始→初始化 | 自然过渡 | — |
| 1: 初始化→无故障 | 自然过渡 | 0x0050 |
| 2: 无故障→启动 | 0x06 | 0x0031 |
| 3: 启动→使能 | 0x07 | 0x0033 |
| 4: 使能→运行 | 0x0F | 0x0037 |
| 5: 运行→使能 | 0x07 | 0x0033 |
| 6: 使能→启动 | 0x06 | 0x0031 |
| 7: 启动→无故障 | 0x00 | 0x0050 |
| 8: 运行→启动 | 0x06 | 0x0031 |
| 9: 运行→无故障 | 0x00 | 0x0050 |
| 10: 使能→无故障 | 0x00 | 0x0050 |
| 11: 运行→快速停机 | 0x02 | 0x0017 |
| 15: 故障→无故障 | 0x80 (bit7上升沿) | 0x0050 |

### 控制字位定义（寄存器 0x0051）

| 位 | 功能 |
|----|------|
| 0 | 启动 (start up) |
| 1 | 电压使能 (voltage Enable) |
| 2 | 快速停机 (Fast Shutdown) |
| 3 | 运行使能 (Run enable) |
| 4,5,6 | 操作模式特殊定义位 |
| 7 | 故障复位 (Fault reset) |

位置模式下 bit4/bit6 的含义:
- bit4: 0→1 表示新的动作
- bit6: 0=GOTO模式(绝对), 1=MOVE模式(相对)

### 状态字位定义（输入寄存器 0x001F）

| 位 | 功能 |
|----|------|
| 0 | 启动 |
| 1 | 使能 |
| 2 | 运行 |
| 3 | 故障 |
| 4 | 电压使能 |
| 5 | 快速停机使能 |
| 6 | 电机无故障 |
| 7 | 警告 |
| 12 | 0=运行完成, 1=运行过程中 |

## 5. 停机方式

两种停机模式:
- **0**: 无减速度停机（立即停止）
- **1**: 按一定减速度停机

触发停机的方式:
1. **操作停机** (0x003A): 运行状态下切换控制字 5/8/9
2. **紧急停机** (0x003B): 非故障状态下发送控制字 0x0002
3. **故障停机** (0x003C): 驱动器故障时自动切换
4. **DI 特殊功能停机**: 数字量输入触发

## 6. 运行模式（寄存器 0x0039）

| 值 | 模式 | 说明 |
|----|------|------|
| 1 | 位置模式 | 绝对/相对位置定位 |
| 2 | 速度模式 | 匀速运行 |
| 3 | 原点回归模式 | 回到设备原点 |
| 4 | 脉冲输入模式 | 仅57H系列支持 |

### 6.1 位置模式

关联寄存器:
- 0x0053: 目标位置 (INTEGER32, pulse)
- 0x0052: 运行方向 (0=反转, 1=正传)
- 0x005B: 最大速度 (Step/s, 默认250)
- 0x005D: 最小速度 (Step/s, 默认16)
- 0x005F: 加速度 (Step/s², 默认1000)
- 0x0061: 减速度 (Step/s², 默认1000)
- 0x0057: 位置最小值 (位置软件限值)
- 0x0059: 位置最大值 (位置软件限值)

**绝对位置运行**: 控制字先发 0x0F，再发 0x1F
**相对位置运行**: 控制字先发 0x4F，再发 0x5F；循环运动重复 4F→5F

### 6.2 速度模式

关联寄存器同位置模式（目标速度用 0x0055）

**操作**: 控制字设为 0x0F 即进入运行，改速时修改目标速度后重发 0x0F

### 6.3 原点回归模式

关联寄存器:
- 0x006B: 原点回归方式 (17~31, 默认17)
- 0x0069: 原点偏移值 (pulse)
- 0x006C: 寻找开关速度 (Step/s, 默认100)
- 0x006E: 寻找零位开关速度 (Step/s, 默认100)
- 0x0072: 零点回归 (0=禁用, 1=启用, 回零后自动运行到零点)

原点回归方式 17~30 使用各种开关组合，方式 31 为快速回归（按绝对位置）

**操作**: 控制字先发 0x0F，再发 0x1F

### 6.4 脉冲输入模式

- 仅 57H 系列支持
- 设置 0x007B = 0x01，保存参数后重启
- EN引脚: 低电平使能，高电平脱机
- STP引脚: PWM脉冲信号输入
- DIR引脚: 低电平反转，高电平正转

## 7. 数字量 I/O

### 数字量输入 (DI)

- 固定输入: DI1~DI3
- 可配置输入: DX1~DX1
- 输入极性参数: 0x002E
- 输入上拉使能: 0x002F（仅57L系列）
- 触发方式: 0x0030 (0=无效, 1=上升沿, 2=下降沿, 3=上升/下降沿)
- 特殊功能: 0x002C (0=无, 1=负限位, 2=正限位, 3=原点开关, 4=立即停机, 5=减速停机, 6=运行方向, 7=使能, 8=运行/停止)
- 数字量输入状态: 输入寄存器 0x0018

### 数字量输出 (DO)

- DX1 配置参数 0x0034 (bit0: 0=输入, 1=输出)
- 故障安全输出选择: 0x0035
- 故障安全状态预定值: 0x0036
- 数字量输出: 0x0037

## 8. 特殊操作

### 设置原点/零点

| 操作 | 寄存器 | 写入值 |
|------|--------|--------|
| 设置原点 | 0x0048 | 0x5348 |
| 设置零点 | 0x0047 | 0x535A |

### 参数保存/恢复

| 操作 | 寄存器 | 写入值 | 说明 |
|------|--------|--------|------|
| 保存所有参数 | 0x0008 | 0x7376 | 约200ms |
| 恢复出厂默认 | 0x000B | 0x6C64 | 重启生效 |
| 硬件自检 | 0x0074 | 0x7465 | |
| 清空错误存储器 | 0x0073 | 0x6C64 | |

## 9. 报警与错误

### 错误寄存器位定义（输入寄存器 0x0025）

| 位 | 分类 |
|----|------|
| 0 | 常规 |
| 1 | 电流 |
| 2 | 电压 |
| 3 | 温度 |
| 4 | 通信 |
| 5 | 子协议 |
| 6 | 预留 |
| 7 | 制造商 |

### 错误码表

| 错误码 | 分类 | 含义 | 触发故障停机 |
|--------|------|------|------------|
| 2200 | 电流 | 过流保护 | 是 |
| 3110 | 电压 | 电源过压 | 是 |
| 3120 | 电压 | 电源欠压 | 是 |
| 4310 | 温度 | 过热报警 | 否 |
| 7121 | 子协议 | 失速报警 | 否 |
| 8612 | 子协议 | 限位报警 | 否 |
| FF00 | 制造商 | 过热关机 | 是 |
| FF01 | 制造商 | 错误的命令 | 否 |
| FF02 | 制造商 | 不能执行的命令 | 否 |
| FF0E | 制造商 | 超负限位报警 | 否 |
| FF0F | 制造商 | 超正限位报警 | 否 |
| FF11 | 制造商 | SPI 通信失败报警 | 否 |

### 清除故障

写 0x80 到控制字寄存器 0x0051（故障源已消除后）

## 10. 完整保持寄存器列表

| 地址 | 名称 | 数量 | 范围 | 单位 | 默认值 | 生效方式 |
|------|------|------|------|------|--------|----------|
| 0x00 | 从站地址 | 1 | 1~247 | - | 1 | 重启 |
| 0x01 | 波特率 | 1 | 0~9 | - | 5 | 重启 |
| 0x02 | 网络数据格式 | 1 | 0~3 | - | 2 | 重启 |
| 0x03 | Modbus返回等待时间 | 1 | 0~10000 | ms | 0 | 重启 |
| 0x08 | 保存所有参数 | 1 | 写0x7376 | - | 1 | 立即 |
| 0x0B | 恢复默认参数 | 1 | 写0x6C64 | - | 1 | 重启 |
| 0x0E | 电阻 | 2 | UNSIGNED32 | mOhm | 290 | 重启 |
| 0x10 | 电感 | 2 | UNSIGNED32 | uH | 1770 | 重启 |
| 0x12 | 反应电动势系数 | 2 | UNSIGNED32 | mV/Hz | 46 | 重启 |
| 0x14 | 电压 | 1 | UNSIGNED8 | V | 24 | 重启 |
| 0x15 | 减速电流 | 1 | 0~10000/4000 | mA | 1000 | 立即 |
| 0x16 | 怠机电流 | 1 | 0~10000/4000 | mA | 500 | 立即 |
| 0x17 | 加速电流 | 1 | 0~10000/4000 | mA | 1000 | 立即 |
| 0x18 | 运行电流 | 1 | 0~10000/4000 | mA | 1000 | 立即 |
| 0x19 | 过载电流 | 1 | 0~60/100 | 100mA | 40/80 | 立即 |
| 0x1A | 细分 | 1 | 0~7(非28系列)/0~4(28系列) | - | 7 | 立即(脱机) |
| 0x1F | 低速优化 | 1 | 0~1 | - | 1 | 立即 |
| 0x2C | 输入特殊功能 | 2 | 0~2290649224 | - | 0 | 立即 |
| 0x2E | 输入极性取反 | 1 | UNSIGNED8 | - | 0 | 立即 |
| 0x2F | 输入上拉使能 | 1 | UNSIGNED8 | - | 0 | 立即 |
| 0x30 | 输入触发方式 | 2 | 0~858993459 | - | 69905 | 立即 |
| 0x34 | I/O输入输出设置 | 1 | UNSIGNED8 | - | 0 | 立即 |
| 0x35 | 故障安全输出选择 | 1 | UNSIGNED8 | - | 0 | 立即 |
| 0x36 | 故障安全状态预定 | 1 | UNSIGNED8 | - | 0 | 立即 |
| 0x37 | 数字量输出 | 2 | UNSIGNED32 | - | 0 | 立即 |
| 0x39 | 运行模式 | 1 | 1~3(非57H)/1~4(57H) | - | 1 | 立即(脱机) |
| 0x3A | 操作启停设置 | 1 | 0~1 | - | 1 | 立即 |
| 0x3B | 急停操作设置 | 1 | 0~1 | - | 1 | 立即 |
| 0x3C | 故障操作设置 | 1 | 0~1 | - | 0 | 立即 |
| 0x43 | 失速检测阈值 | 2 | 0~100/0~4000 | 100mA/mA | 80/3000 | 立即 |
| 0x47 | 设置零点 | 1 | 仅0x535A | - | 0 | 立即 |
| 0x48 | 设置原点 | 1 | 仅0x5348 | - | 0 | 立即 |
| 0x51 | 运动控制字 | 1 | UNSIGNED16 | - | 0 | 立即 |
| 0x52 | 运动方向 | 1 | 0~1 | - | 0 | 立即 |
| 0x53 | 目标位置(位置模式) | 2 | INTEGER32 | pulse | 0 | 立即 |
| 0x55 | 目标速度(速度模式) | 2 | 0~15610 | Step/s | 100 | 立即 |
| 0x57 | 位置最小值 | 2 | INTEGER32 | pulse | 0 | 立即 |
| 0x59 | 位置最大值 | 2 | INTEGER32 | pulse | 0 | 立即 |
| 0x5B | 最大速度 | 2 | 0~15610 | Step/s | 250 | 立即 |
| 0x5D | 最小速度 | 2 | 0~1000 | Step/s | 16 | 立即 |
| 0x5F | 加速度 | 2 | 1~59590 | Step/s² | 1000 | 立即 |
| 0x61 | 减速度 | 2 | 1~59590 | Step/s² | 1000 | 立即 |
| 0x69 | 原点偏移值 | 2 | INTEGER32 | pulse | 0 | 立即 |
| 0x6B | 原点回归方式 | 1 | 17~31 | - | 17 | 立即 |
| 0x6C | 寻找开关速度 | 2 | 0~15610 | Step/s | 100 | 立即 |
| 0x6E | 寻找零位速度 | 2 | 0~15610 | Step/s | 100 | 立即 |
| 0x72 | 零点回归 | 1 | 0~1 | - | 0 | 立即 |
| 0x73 | 清空错误存储器 | 1 | 仅0x6C64 | - | 1 | 立即 |
| 0x74 | 硬件自检 | 1 | 仅0x7465 | - | 1 | 立即 |
| 0x75 | 用户程序控制 | 1 | 0~0x03 | - | 0x00 | 立即 |
| 0x76 | 用户程序状态 | 1 | 0~0x111 | - | 0x000 | 只读 |
| 0x7B | 电压电流模式切换 | 1 | 0~0x1 | - | 0x00 | 重启 |

**注意**: 0x47, 0x48, 0x51, 0x52, 0x53, 0x55 修改后不可保存，每次上电恢复默认值。

## 11. 完整输入寄存器列表

| 地址 | 名称 | 数量 | 说明 |
|------|------|------|------|
| 0x00 | 厂商名称 | 2 | |
| 0x02 | 产品序列号 | 2 | |
| 0x04 | 硬件版本号 | 2 | |
| 0x0A | 软件版本号 | 2 | |
| 0x0C | 工作时间 | 2 | 累积工作时间(小时) |
| 0x16 | 驱动电路状态 | 1 | |
| 0x17 | 输入电压 | 1 | 单位: V |
| 0x18 | 数字量输入 | 2 | 高16位=DI状态, 低16位=特殊功能状态 |
| 0x1E | 当前操作模式 | 1 | |
| 0x1F | 运动状态字 | 1 | 参考状态字位定义 |
| 0x20 | 当前运动方向 | 1 | |
| 0x21 | 当前显示位置 | 2 | 单位: pulse |
| 0x23 | 当前运行速度 | 2 | 显示值=实际速度×10, 单位: Step/s |
| 0x25 | 出错误寄存器 | 1 | 16位错误分类标志 |
| 0x26 | 当前错误报警值 | 1 | 错误码 |
| 0x27 | 错误存储器报警个数 | 1 | |
| 0x28~0x2F | 历史报警 1~8 | 各1 | 历史错误码记录 |

## 12. 指令速查表

### 基本读写指令

```
读保持寄存器:   01 03 xx xx 00 0z (CRC)     xx xx=参数地址, 0z=寄存器数量
读输入寄存器:   01 04 xx xx 00 0z (CRC)
写1个寄存器:    01 06 xx xx yy yy (CRC)     yy yy=参数值
写2个寄存器:    01 10 xx xx 00 02 04 yy yy yy yy (CRC)
```

### 位置模式 - 相对运动

```
1. 设置目标位置:   01 10 00 53 00 02 04 yy yy yy yy (CRC)
2. 电机启动:       01 06 00 51 00 06 (CRC)    -- 已在位置模式可省
3. 切换位置模式:   01 06 00 39 00 01 (CRC)    -- 已在位置模式可省
4. 电机启动:       01 06 00 51 00 06 (CRC)
5. 电机使能:       01 06 00 51 00 07 (CRC)
6. 发控制字 4F:    01 06 00 51 00 4F (CRC)
7. 发控制字 5F:    01 06 00 51 00 5F (CRC)    -- 电机开始相对位置运行
继续运动: 重复 4F → 5F
```

### 位置模式 - 绝对运动

```
1. 设置目标位置:   01 10 00 53 00 02 04 yy yy yy yy (CRC)
2. 电机启动:       01 06 00 51 00 06 (CRC)
3. 切换位置模式:   01 06 00 39 00 01 (CRC)
4. 电机启动:       01 06 00 51 00 06 (CRC)
5. 电机使能:       01 06 00 51 00 07 (CRC)
6. 发控制字 0F:    01 06 00 51 00 0F (CRC)
7. 发控制字 1F:    01 06 00 51 00 1F (CRC)    -- 电机开始绝对位置运行
继续运动: 修改目标位置后发 0F → 1F
```

### 速度模式

```
1. 设置目标速度:   01 10 00 55 00 02 04 yy yy yy yy (CRC)
2. 设置运动方向:   01 06 00 52 00 00 (CRC) 或 01 06 00 52 00 01 (CRC)
3. 电机启动:       01 06 00 51 00 06 (CRC)    -- 已在速度模式可省
4. 切换速度模式:   01 06 00 39 00 02 (CRC)    -- 已在速度模式可省
5. 电机启动:       01 06 00 51 00 06 (CRC)
6. 电机使能:       01 06 00 51 00 07 (CRC)
7. 发控制字 0F:    01 06 00 51 00 0F (CRC)    -- 电机开始运行
修改速度: 修改目标速度和方向后发 0F
```

### 原点回归模式

```
1. 电机启动:       01 06 00 51 00 06 (CRC)    -- 已在原点回归模式可省
2. 切换原点回归:   01 06 00 39 00 03 (CRC)    -- 已在原点回归模式可省
3. 电机启动:       01 06 00 51 00 06 (CRC)
4. 电机使能:       01 06 00 51 00 07 (CRC)
5. 发控制字 0F:    01 06 00 51 00 0F (CRC)
6. 发控制字 1F:    01 06 00 51 00 1F (CRC)    -- 电机开始原点回归
```

### 状态切换与停机

```
电机使能(可停机): 01 06 00 51 00 07 (CRC)
电机启动(可停机): 01 06 00 51 00 06 (CRC)
电机急停:         01 06 00 51 00 02 (CRC)    -- 恢复前需先写 06
```

### 参数管理

```
恢复制造商默认:   01 06 00 0B 6C 64 (CRC)
恢复用户自定义:   01 06 00 0B 64 6C (CRC)
保存到制造商列表: 01 06 00 08 73 76 (CRC)
保存到用户列表:   01 06 00 08 76 73 (CRC)
清除故障状态:     01 06 00 51 00 80 (CRC)
```
