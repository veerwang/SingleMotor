# PDF 处理报告

**文件**: `documents/documents/STM系列CAN&RS485通信一体化步进电机常见问题及解决方法_A01.pdf`
**总页数**: 18 页
**提取目标**: 提取精华摘要
**处理时间**: 2026-02-13

---

## 提取结果

### 1. 上位机软件显示"没有对应的配置文件"

**原因**: 硬件版本号未写入 ConfigIndex 文件

**解决步骤**:
1. 打开软件"其它"栏，查看并复制硬件版本号（如 `4203A-485-B`）
2. 打开安装包中的 `ConfigIndex` 文件（JSON 格式）
3. 将硬件版本号按开环/闭环格式写入对应条目

---

### 2. 从属设备忙报警

**原因**: 电机处于**使能**状态

**解决**: 先脱机（Disable），再进行设置参数或模式切换

---

### 3. 参数设置后再获取无参数

**原因**: 设置后未保存

**解决**: 电机参数设置后需点击**保存参数**，否则无法保留

---

### 4. 波特率丢失，通过广播抢占重置波特率

当通信参数不确定或丢失时，可通过**广播抢占**恢复出厂通信设置。

**广播抢占请求报文**:

| 从机地址 | 功能码 | 电机序列号 | CRC |
|---------|--------|-----------|-----|
| 0x00 | 0xC2（闭环）/ 0xD2（开环） | 4B（铭牌序列号转十六进制） | 2B |

**操作要点**:
- 需在电机**上电前 1 秒内**发送
- 抢占成功后 RUN 指示灯闪烁
- 成功后通信参数恢复为**出厂默认值**

---

### 5. 获取位置值读哪个寄存器

| 类型 | 寄存器 | Modbus 报文 |
|------|--------|-----------|
| 闭环 | 输入寄存器 0x1A（当前编码器值） | `01 04 00 1A 00 02` |
| 开环 | 输入寄存器 0x21（当前显示位置） | `01 04 00 21 00 02` |

---

### 6. 电机转动一圈多少脉冲

取决于细分设置（寄存器 0x1A）：

| 细分 | 脉冲数/圈 | 每步角度 |
|------|---------|--------|
| Full step | 200 | 1.8° |
| Hall step | 400 | 0.9° |
| 1/4 | 800 | 0.45° |
| 1/8 | 1600 | 0.225° |
| 1/16 | 3200 | 0.1125° |

---

### 7. 电机掉电后再上电无法记住位置值

**解决**: 将寄存器 **0x45 位置恢复方式**设置为**多圈内位置**

**注意事项**:
- 掉电后电机轴不能有转动
- 电源掉电速度不能过快，否则可适当增大 0x1C 欠压报警值（略小于母线电压值），或更换电源

---

### 8. 参数设置后电机掉电再上的参数无法保存

**正确步骤**:
1. 设置参数
2. 点击**保存当前参数**

---

### 9. 电流类型及关系

**四种电流含义**:

| 寄存器 | 名称 | 含义 |
|--------|------|------|
| 0x16 | 怠机电流 | 电机报机（空闲）时的电流 |
| 0x17 | 堵转电流 | 电机发生堵转运行的最大电流 |
| 0x18 | 运行电流 | 电机带载运行时的最大电流 |
| 0x19 | 过载电流 | 电机触发过流报警的最大电流 |

**设置关系**: `过载电流 > 堵转电流 > 运行电流`

**注意**: 怠机电流越大，电机发热越大

---

### 10. 速度模式和位置模式下速度寄存器的区分

| 模式 | 速度寄存器 | 说明 |
|------|---------|------|
| 位置模式 | **0x5B**（最大速度） | 位置模式下的运行速度 |
| 速度模式 | **0x55**（目标速度） | 速度模式下的运行速度，受 0x5B 最大速度限制 |

---

### 11. 速度换算：Step/s 与 RPM

**公式**: `Step/s × 0.3 = RPM`

速度模式下按一圈 200 个脉冲计算。

---

### 12. 电机通讯默认参数

| 参数 | 默认值 |
|------|-------|
| 节点地址 | 1 |
| 波特率 | 115200 bps |
| 数据位 | 8 |
| 停止位 | 1 |
| 校验位 | 无校验 |

---

### 13. 电机上电后对应的状态

- **脱机状态**（上电通讯后）: 绿灯常亮，黄灯灭
- **使能状态**（驱动器输出电压给电机）: 绿灯常亮，黄灯**亮**

---

### 14. PDO 未配置提示

**解决**: 切换到电机参数界面，在 PDO 配置中勾选 **PDO2** 为 ON

---

### 15. 限位开关配置

**配置步骤**:
1. 在 **0x23 输入特殊功能** 中为对应 DI 选择功能（如：正限位开关、反限位开关、原点开关等）
2. 在 **0x26 输入触发方式** 中设置触发模式（上升沿/下降沿/双沿触发）

**DI 特殊功能选项**: 0=无动作, 1=负限位开关, 2=正限位开关, 3=原点开关, 4=立即停机, 5=减速度停机, 6=变更方向, 7=使能, 8=运行/停止

---

### 16. NiMotionModbus-IDE 使用步骤

1. 解压并打开 NiMotionModbusIDE
2. 连接电机电源线和通讯线，打开软件通讯设备（默认 115200bps）
3. 通讯设置：设备类型 NiMotion USB-485，设备号 0，选择波特率，勾选扫描电机
4. 连接成功后可在电机参数页查看/修改参数

**位置模式操作**:
- 步距角 1.8°，整步 200 脉冲/圈，可选细分 2/4/6/8/16（默认 1/8，即 1600 脉冲/圈）
- 通过 0x5B 最大速度修改位置模式运行速度
- 支持相对位置运动（Move）和绝对位置运动（Goto）

**速度模式操作**:
- 与细分无关，0x55 目标速度即运行速度，受 0x5B 最大速度限制
- 设置速度后点击正转/反转启动

**原点回归模式**:
- 0x6C 寻找原点速度、0x6E 接近原点速度可根据需要设置，受 0x5B 限制
- 默认回归方式为 31（快速回原点），方式 17-30 可参照通讯手册
- DI/DO 栏中配置原点开关等

---

### 17-19. 报警相关 Modbus 报文

| 操作 | 报文 |
|------|------|
| 获取当期报警（方式1） | `01 08 00 19 00 00 xx xx` |
| 获取当期报警（方式2） | `01 04 00 26 00 01 xx xx` |
| 获取历史报警 | `01 04 00 27 00 09 xx xx` |
| 清除历史报警 | `01 06 00 73 6C 64 xx xx` |

---

### 20. 清除故障状态

**报文**: `01 06 00 51 00 80 xx xx`

（向控制字 0x51 写入 0x0080）

---

### 21. 读取电机当前状态字

**报文**: `01 04 00 1F 00 01 xx xx`

（读取输入寄存器 0x1F 状态字）

---

### 22. 寄存器 0x20 方向不能点击切换

**原因**: 0x20 是**输入寄存器**（只读），不可直接写入

**解决**: 通过写入**保持寄存器 0x52**（位置模式或速度模式寄存器）设置方向，0=反转，1=正转

---

### 23. 原点、零点、原点偏移的关系

```
机械原点 = 机械零点 + 原点偏移
```

当原点偏移为零时，原点 = 零点

---

### 24. 外部光电开关/接近开关配置接线

**配置方法**:
1. 在 **0x2C 输入特殊功能** 中设置 DI 功能（如 DI0=负限位开关, DI1=正限位开关）
2. 在 **0x30 输入触发方式** 中设置触发方式（上升沿触发）
3. 点击设置参数，保存当前参数

**接线**: 传感器正常供电，信号线接电机 DI 输入口，0V 与电机 IO 的地共在一起，**低电平有效**

---

### 25. 参数设置及保存方法

电机在**脱使能状态**下：
1. 先点击**设置参数**
2. 再点击**保存当前参数**

---

### 26. 堵转报警/未知错误报警的处理方法

**方法一**: 适当增加电机**运行电流**（0x18）和**堵转电流**（0x17）

**方法二**: 增加**堵转报警阈值**（0x43），例如从 5 增大到 30

---

### 27. 上位机软件获取电机报警信息

在报警信息界面中可以：
- 获取最近报警
- 获取历史报警
- 清除历史报警
- 清除故障状态

---

## 开发速查：常用 Modbus 报文汇总

| 功能 | Modbus 报文（从站地址=01） |
|------|------------------------|
| 读当前位置（闭环） | `01 04 00 1A 00 02` |
| 读当前位置（开环） | `01 04 00 21 00 02` |
| 读状态字 | `01 04 00 1F 00 01` |
| 清除故障 | `01 06 00 51 00 80` |
| 获取当期报警 | `01 08 00 19 00 00` 或 `01 04 00 26 00 01` |
| 获取历史报警 | `01 04 00 27 00 09` |
| 清除历史报警 | `01 06 00 73 6C 64` |
| 设置方向 | 写保持寄存器 0x52（0=反转, 1=正转） |

---

## 处理详情

- 处理块数: 1 块（18 页一次性读取）
- 有效内容块: 1 块（全部有效）
- 覆盖问题: Q1-Q27 共 27 个常见问题及解决方法
